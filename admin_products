<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin - Gestionar Productos</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .panel-admin{max-width:900px;margin:20px auto;background:#fff;padding:18px;border-radius:8px}
    input,textarea{width:100%;padding:8px;margin:8px 0;border-radius:6px;border:1px solid #ccc}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
  </style>
</head>
<body>
  <div class="panel-admin">
    <h2>Panel Admin (local)</h2>
    <form id="f">
      <input id="n" placeholder="Nombre" required>
      <input id="pr" type="number" placeholder="Precio" required>
      <input id="cat" placeholder="Categoría" required>
      <input id="img" placeholder="URL imagen (ej: https://...)" required>
      <textarea id="desc" placeholder="Descripción"></textarea>
      <label><input id="isOffer" type="checkbox"> Marcar como oferta</label>
      <button type="submit" class="btn primary">Añadir producto</button>
    </form>

    <h3>Productos guardados por admin (localStorage)</h3>
    <div id="lista-admin"></div>

    <h3>Export / Import</h3>
    <button id="export-btn" class="btn">Exportar JSON</button>
    <input id="import-area" placeholder="Pega JSON aquí para importar" style="width:100%;height:90px;">
    <button id="import-btn" class="btn">Importar</button>

    <p>Nota: esto guarda en localStorage (clave <code>admin_products</code>). La tienda carga estos productos y los muestra junto con los productos base.</p>
    <p><a href="index.html">← Volver a la tienda</a></p>
  </div>

<script>
function loadAdmin(){ return JSON.parse(localStorage.getItem('admin_products') || '[]'); }
function saveAdmin(list){ localStorage.setItem('admin_products', JSON.stringify(list)); renderAdmin(); }

function renderAdmin(){
  const list = loadAdmin();
  const cont = document.getElementById('lista-admin');
  cont.innerHTML = '';
  if(!list.length) { cont.innerHTML = '<p>No hay productos admin.</p>'; return; }
  const table = document.createElement('table');
  table.innerHTML = '<thead><tr><th>Nombre</th><th>Cat</th><th>Precio</th><th>Acciones</th></tr></thead>';
  const tbody = document.createElement('tbody');
  list.forEach((p,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${p.nombre}</td><td>${p.categoria}</td><td>${p.precio}</td>
      <td><button onclick="borrar(${i})">Eliminar</button></td>`;
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);
  cont.appendChild(table);
}

document.getElementById('f').addEventListener('submit', e=>{
  e.preventDefault();
  const name = document.getElementById('n').value.trim();
  const precio = Number(document.getElementById('pr').value);
  const cat = document.getElementById('cat').value.trim();
  const img = document.getElementById('img').value.trim();
  const desc = document.getElementById('desc').value.trim();
  const isOffer = document.getElementById('isOffer').checked;
  const list = loadAdmin();
  const item = { id: 'adm_' + Date.now(), nombre:name, precio:precio, categoria:cat, imagen:img, descripcion:desc, oferta: isOffer };
  list.unshift(item);
  saveAdmin(list);
  e.target.reset();
});

function borrar(i){ const list = loadAdmin(); list.splice(i,1); saveAdmin(list); }

document.getElementById('export-btn').onclick = ()=>{
  const list = loadAdmin();
  const json = JSON.stringify(list, null, 2);
  const win = window.open();
  win.document.write('<pre>'+json+'</pre>');
};

document.getElementById('import-btn').onclick = ()=>{
  try{
    const txt = document.getElementById('import-area').value.trim();
    if(!txt) return alert('Pega JSON válido');
    const parsed = JSON.parse(txt);
    if(!Array.isArray(parsed)) throw new Error('JSON debe ser array');
    saveAdmin(parsed);
    alert('Importado OK');
  } catch(e){ alert('Error: '+e.message) }
};

renderAdmin();
</script>
</body>
</html>
